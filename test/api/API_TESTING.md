# API 测试套件文档

## 目录结构

```txt
test/api/
├── README.http              # 测试套件主入口和快速检查
├── common/                  # 通用测试
│   └── health.http         # 健康检查和基础服务测试
├── user/                   # 用户模块测试
│   ├── crud.http           # 用户CRUD操作测试
│   ├── validation.http     # 输入验证和错误处理测试
│   ├── boundary.http       # 边界条件和特殊场景测试
│   └── performance.http    # 性能和并发测试
└── env/                    # 环境配置
    ├── development.http    # 开发环境配置
    └── production.http     # 生产环境配置
```

## 测试文件说明

### 1. README.http

- **用途**: 测试套件的主入口文件
- **包含**: 快速健康检查、API可用性验证、环境信息显示
- **使用场景**: 开发时快速验证服务状态

### 2. common/health.http

- **用途**: 基础服务健康检查
- **测试内容**:
  - 服务健康状态检查
  - 根路径访问测试
  - API版本信息检查
- **验证点**: 服务可用性、基础响应

### 3. user/crud.http

- **用途**: 用户模块核心CRUD操作测试
- **测试流程**:
  1. 获取用户列表
  2. 创建新用户
  3. 根据ID获取用户详情
  4. 更新用户信息
  5. 验证更新结果
  6. 删除用户
  7. 验证删除结果
- **验证点**:
  - 状态码正确性
  - 响应数据结构
  - 业务逻辑正确性
  - 数据一致性

### 4. user/validation.http

- **用途**: 输入验证和错误处理测试
- **测试场景**:
  - 缺少必填字段
  - 邮箱格式错误
  - 密码长度不足
  - 用户不存在(404)
  - 无效ID格式
  - JSON格式错误
- **验证点**: 错误状态码、错误信息准确性

### 5. user/boundary.http

- **用途**: 边界条件和特殊场景测试
- **测试场景**:
  - 最长/最短用户名
  - 特殊字符邮箱
  - 重复邮箱处理
  - 中文/英文/混合字符用户名
- **验证点**: 边界值处理、字符编码支持

### 6. user/performance.http

- **用途**: 性能和并发测试
- **测试内容**:
  - 批量用户创建
  - 列表查询性能
  - 并发请求处理
  - 快速连续请求
  - 响应时间监控
- **验证点**: 响应时间、并发处理能力

## 使用指南

### 快速开始

1. 启动服务: `make run`
2. 运行快速检查: 执行 `README.http` 中的健康检查
3. 基础功能测试: 执行 `user/crud.http`

### 完整测试流程

```bash
# 推荐执行顺序:
1. common/health.http      # 确保服务正常
2. user/crud.http          # 验证核心功能
3. user/validation.http    # 验证错误处理
4. user/boundary.http      # 验证边界情况
5. user/performance.http   # 验证性能表现
```

### 环境配置

- 开发环境: 使用默认配置 (localhost:8080)
- 生产环境: 修改各文件顶部的环境变量或引用 `env/production.http`

### 测试数据管理

- 测试会创建临时数据进行验证
- `performance.http` 包含数据清理逻辑
- 建议使用独立的测试数据库

## 最佳实践

### 1. 测试命名规范

- 使用清晰的测试名称描述测试目的
- 包含预期结果的验证逻辑

### 2. 错误处理验证

- 验证错误状态码的准确性
- 检查错误信息的可读性
- 确保错误响应结构一致

### 3. 数据一致性

- 创建后立即验证数据
- 更新后确认变更生效
- 删除后确认数据不可访问

### 4. 性能基准

- 设置合理的响应时间阈值
- 监控内存和CPU使用情况
- 测试不同负载下的表现

## 扩展指南

### 添加新模块测试

1. 在对应目录创建新的 `.http` 文件
2. 遵循现有的命名和结构约定
3. 包含完整的测试流程和验证点
4. 更新本文档

### 自定义验证逻辑

```javascript
> {%
  client.test("自定义测试名称", function() {
    // 状态码验证
    client.assert(response.status === 200, "状态码验证");
    
    // 响应体验证
    client.assert(response.body.data !== undefined, "数据结构验证");
    
    // 业务逻辑验证
    client.assert(response.body.data.id > 0, "业务规则验证");
    
    // 保存变量供后续使用
    client.global.set("variableName", response.body.data.id);
  });
%}
```

## 故障排查

### 常见问题

1. **连接失败**: 检查服务是否启动，端口是否正确
2. **认证错误**: 确认认证令牌是否有效（如果需要）
3. **数据不一致**: 检查数据库状态，清理测试数据
4. **性能异常**: 检查服务器资源使用情况

### 调试技巧

- 使用 `console.log()` 输出调试信息
- 检查响应头和状态码
- 验证请求体格式和内容
- 确认环境变量设置正确
